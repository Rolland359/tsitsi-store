{% extends 'dashboard/base_dashboard.html' %}
{% load static %}
{% load humanize %}

{% block title %}Produits | {{ title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'dashboard/css/dashboard_products.css' %}">
{% endblock %}

{% block dashboard_content %}
<div class="card shadow-lg border-0">
    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center flex-wrap">
        <h5 class="mb-0 fw-bold text-dark">
            <i class="fas fa-shopping-bag me-2 text-primary"></i> Liste des Produits
            <span id="product-count" class="badge bg-light text-muted border ms-2">{{ products.count }}</span>
        </h5>
        <div class="search-container">
            <div class="input-group shadow-sm">
                <span class="input-group-text bg-white border-end-0 text-muted">
                    <i class="fas fa-search"></i>
                </span>
                <input type="text" id="ajax-search" class="form-control border-start-0" placeholder="Rechercher un produit..." aria-label="Rechercher un produit" autocomplete="off">
            </div>
        </div>
        <a href="{% url 'admin:store_product_add' %}" class="btn btn-primary btn-sm shadow-sm">
            <i class="fas fa-plus me-1"></i> Nouveau Produit
        </a>
    </div>
    
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light text-secondary">
                    <tr>
                        <th class="px-4">Image</th>
                        <th>Nom du Produit</th>
                        <th>Catégorie</th>
                        <th>Prix (Ar)</th>
                        <th>Stock</th>
                        <th>Dispo.</th>
                        <th class="text-end px-4">Actions</th>
                    </tr>
                </thead>
                <tbody id="product-table-body">
                    {% include 'dashboard/partials/product_table_results.html' %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
    <div id="liveToast" class="toast align-items-center text-white border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                <i id="toastIcon" class="fas me-2"></i>
                <span id="toastMessage"></span>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // On définit CSRF_TOKEN AVANT de charger le fichier JS externe
    const CSRF_TOKEN = '{{ csrf_token }}';
</script>
<script src="{% static 'dashboard/js/dashboard_products.js' %}"></script>
{% endblock %}